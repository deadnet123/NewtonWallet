sudo: true
language: cpp

matrix:
  include:
  
  # ubuntu xenial gcc
- os: linux
  dist: xenial
  compiler: gcc  
  addons:
    apt:
     sources:
        - ubuntu-toolchain-r-test
     packages:        
        - libboost1.55-all-dev
  env:
    - MATRIX_EVAL="CC=gcc && CXX=gcc++"
    - LABEL="ubuntu-gcc" 
    
   # osx clang   
 - os: osx  
   osx_image: xcode10
   compiler: clang
    addons:
      homebrew:
       packages:
       - boost
       - qt5
    update: true
    env:
    - MATRIX_EVAL="CC=clang && CXX=clang++"
    - LABEL="osx-clang"
    
  before_install:
    - eval $MATRIX_EVAL
    - if [ $TRAVIS_OS_NAME = linux ];  then
    - sudo add-apt-repository --yes ppa:ubuntu-sdk-team/ppa
    - sudo apt-get update -qq
    - sudo apt-get install qtbase5-dev qtdeclarative5-dev
    - sudo apt-get install qt5-default qttools5-dev-tools
      qmake -v;
      fi
    - if [ $TRAVIS_OS_NAME = osx ];  then
      brew link --force qt5
      sudo ln -s /usr/local/Cellar/qt/5.11.0/mkspecs /usr/local/mkspecs
      sudo ln -s /usr/local/Cellar/qt/5.11.0/plugins /usr/local/plugins
      sudo ls /usr/local/opt/qt5/lib/cmake/Qt5Widgets/Qt5WidgetsConfig.cmake
      echo "Adding brewed Qt5 to path";
      export PATH=/usr/local/opt/qt5/bin:$PATH;
      export PATH=/usr/local/Cellar/qt5/5.11.0/:$PATH;
      qmake -v;
      fi
           
script:
- eval $MATRIX_EVAL
- git clone https://github.com/livenet123/Newton.git cryptonote
- mkdir build && cd build
- cmake -DCMAKE_BUILD_TYPE=Release .. && make

before_deploy:
- mkdir NewtonWallet-${TRAVIS_TAG}
- mv NewtonWallet NewtonWallet-${TRAVIS_TAG}/
- tar -cvfz NewtonWallet-${TRAVIS_TAG}-${TRAVIS_OS_NAME}.tar.gz NewtonWallet-${TRAVIS_TAG}/
- git tag "$(date +'%Y%m%d%H%M%S')-$(git log --format=%h -1)"

deploy:
  provider: releases
  api_key:
    secure:
  file:
    - NewtonWallet-${TRAVIS_TAG}-${TRAVIS_OS_NAME}.tar.gz
  skip_cleanup: true
  on:
    repo: livenet123/NewtonWallet
    tags: true
